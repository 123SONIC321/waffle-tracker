<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Waffle Optimizer</title>
    <style>
        :root {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-color: #e0e0e0;
            --accent: #bb86fc;
            --error: #cf6679;
            --success: #03dac6;
        }
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: Tahoma, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
        }
        .container {
            width: 100%;
            max-width: 400px;
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }
        h2 { text-align: center; color: var(--accent); margin-bottom: 5px; }
        .stats {
            display: flex;
            justify-content: space-between;
            background: #2c2c2c;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            font-size: 1.1em;
            font-weight: bold;
        }
        .input-group { margin-bottom: 15px; }
        input[type="number"], input[type="text"] {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #444;
            background: #333;
            color: white;
            font-size: 16px;
            box-sizing: border-box;
            text-align: center;
        }
        button {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
            transition: 0.2s;
        }
        .btn-calc { background-color: var(--accent); color: #000; }
        .btn-loss { background-color: #333; border: 1px solid var(--error); color: var(--error); }
        .btn-reset { background-color: transparent; color: #666; margin-top: 20px; font-size: 12px; }
        .log-box {
            background: #000;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            height: 100px;
            overflow-y: auto;
            margin-top: 15px;
            border: 1px solid #333;
        }
        .alert {
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            text-align: center;
            display: none;
        }
        .alert-danger { background: rgba(207, 102, 121, 0.2); color: var(--error); border: 1px solid var(--error); }
        .alert-success { background: rgba(3, 218, 198, 0.2); color: var(--success); border: 1px solid var(--success); }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ§‡ ÙˆØ§ÙÙ„ Ø´Ù…Ø§Ø±</h2>
    <div style="text-align:center; font-size:12px; color:#888;">Brawl Stars Optimizer</div>

    <div class="stats">
        <div>ğŸ’° Ù…ÙˆØ¬ÙˆØ¯ÛŒ: <span id="totalDisplay" style="color:var(--success)">0</span></div>
        <div>ğŸ¯ Ù…Ø§Ù†Ø¯Ù‡: <span id="gapDisplay">94</span></div>
    </div>

    <div id="trapAlert" class="alert alert-danger">âš ï¸ Ø®Ø·Ø± ØªÙ„Ù‡! Ø¨Ø§Ø®ØªÙ† = Ù‚ÙÙ„ Ø´Ø¯Ù† Ø±ÙˆÛŒ Û¹Ûµ</div>
    <div id="winAlert" class="alert alert-success">ğŸ‰ Ø¢Ù…Ø§Ø¯Ù‡ Ø±Ø§Ù† Ù†Ù‡Ø§ÛŒÛŒ (Perfect Run)</div>

    <div class="input-group">
        <label style="font-size:12px; color:#aaa;">Ú©Ø¯ Ø¨Ø§Ø²ÛŒ (Ù…Ø«Ù„Ø§Ù‹ 625):</label>
        <input type="text" id="runCode" placeholder="Ú©Ø¯ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯..." inputmode="numeric">
        <button class="btn-calc" onclick="processCode()">â• Ø«Ø¨Øª Ú©Ø¯</button>
    </div>

    <div style="display:flex; gap:10px;">
        <button class="btn-loss" onclick="addLoss()">ğŸ’€ Ø¨Ø§Ø®Øª Ø³Ø±ÛŒØ¹ (+1)</button>
        <button class="btn-loss" style="border-color:#444; color:#aaa;" onclick="undo()">â†©ï¸ Ø¨Ø§Ø²Ú¯Ø´Øª</button>
    </div>

    <div class="log-box" id="logArea">
        <div>Ø¢Ù…Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹...</div>
    </div>

    <div style="margin-top:20px; border-top:1px solid #333; padding-top:10px;">
        <label style="font-size:12px;">Ù‡Ø¯Ù (Target):</label>
        <input type="number" id="targetCap" value="94" onchange="updateUI()">
        <button class="btn-reset" onclick="resetAll()">ğŸ—‘ï¸ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª</button>
    </div>
</div>

<script>
    // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ ÙˆØ¶Ø¹ÛŒØª
    let totalWaffles = 0;
    let historyLog = [];
    
    // Ø¬ÙˆØ§ÛŒØ²
    const STAGE_REWARDS = {1: 10, 2: 12, 3: 14, 4: 16, 5: 18};
    const RANK_BONUS = {1: 5, 2: 4, 3: 3, 4: 2};

    // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø² Ø­Ø§ÙØ¸Ù‡ Ú¯ÙˆØ´ÛŒ
    window.onload = function() {
        const saved = localStorage.getItem('waffleTotal');
        if(saved) totalWaffles = parseInt(saved);
        const savedLog = localStorage.getItem('waffleLog');
        if(savedLog) document.getElementById('logArea').innerHTML = savedLog;
        updateUI();
    }

    function saveState() {
        localStorage.setItem('waffleTotal', totalWaffles);
        localStorage.setItem('waffleLog', document.getElementById('logArea').innerHTML);
        updateUI();
    }

    function log(msg, color='white') {
        const area = document.getElementById('logArea');
        const line = `<div style="color:${color}">> ${msg}</div>`;
        area.innerHTML = line + area.innerHTML;
    }

    function processCode() {
        const input = document.getElementById('runCode');
        const codeStr = input.value;
        if (!codeStr) return;

        let runTotal = 0;
        let currentStage = 1;
        let i = 0;

        while (i < codeStr.length) {
            const char = codeStr[i];
            if (isNaN(char)) { i++; continue; }
            const rank = parseInt(char);

            if (rank >= 1 && rank <= 4) { // Win
                const gain = STAGE_REWARDS[currentStage] + (RANK_BONUS[rank] || 0);
                runTotal += gain;
                log(`S${currentStage} (R${rank}): +${gain}`, '#03dac6');
                currentStage++;
                if (currentStage > 5) break;
            } else { // Loss
                runTotal += 1;
                log(`S${currentStage} Loss: +1`, '#cf6679');
                currentStage = 1;
            }
            i++;
        }

        totalWaffles += runTotal;
        input.value = '';
        saveState();
    }

    function addLoss() {
        totalWaffles += 1;
        log("Ø¨Ø§Ø®Øª Ø³Ø±ÛŒØ¹: +1", '#cf6679');
        saveState();
    }

    function undo() {
        if (totalWaffles > 0) {
            totalWaffles -= 1;
            log("Ø¨Ø§Ø²Ú¯Ø´Øª (Undo): -1", '#aaa');
            saveState();
        }
    }

    function resetAll() {
        if(confirm("Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù†ÛŒØ¯ØŸ Ù‡Ù…Ù‡ Ú†ÛŒ Ù¾Ø§Ú© Ù…ÛŒØ´Ù‡!")) {
            totalWaffles = 0;
            document.getElementById('logArea').innerHTML = '';
            localStorage.clear();
            updateUI();
        }
    }

    function updateUI() {
        const target = parseInt(document.getElementById('targetCap').value);
        const remaining = target - totalWaffles;
        
        document.getElementById('totalDisplay').innerText = totalWaffles;
        document.getElementById('gapDisplay').innerText = remaining;

        // Ù…Ù†Ø·Ù‚ Ù‡Ø´Ø¯Ø§Ø±
        document.getElementById('trapAlert').style.display = 'none';
        document.getElementById('winAlert').style.display = 'none';

        if (totalWaffles === target) {
            document.getElementById('winAlert').style.display = 'block';
        } else if (totalWaffles + 1 === 95) {
            document.getElementById('trapAlert').style.display = 'block';
        }
    }
</script>

</body>
</html>
