<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brawl Stars Waffle</title>
    
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet" type="text/css" />

    <style>
        :root {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-color: #f0f0f0;
            --accent: #bb86fc;
            --error: #cf6679;
            --success: #00e676;
            --warning: #ffeb3b;
            --font-stack: 'Vazirmatn', sans-serif;
        }
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: var(--font-stack);
            margin: 0;
            padding: 15px;
            display: flex;
            justify-content: center;
        }
        .container {
            width: 100%;
            max-width: 450px;
            background-color: var(--card-bg);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.6);
        }
        h2 { 
            text-align: center; 
            color: var(--accent); 
            margin: 0 0 20px 0;
            font-weight: 900;
            font-size: 1.6rem;
            text-shadow: 0 0 10px rgba(187, 134, 252, 0.3);
        }
        
        /* Ø¨Ø®Ø´ Ø¢Ù…Ø§Ø± */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: #2d2d2d;
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            border: 1px solid #3d3d3d;
        }
        .stat-label {
            font-size: 0.85rem;
            color: #aaa;
            margin-bottom: 5px;
        }
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
        }
        
        /* Ø¬Ø¹Ø¨Ù‡ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ù‡ÙˆØ´Ù…Ù†Ø¯ */
        .suggestion-box {
            background: linear-gradient(135deg, #303030, #252525);
            border-right: 5px solid var(--accent);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 25px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        .suggestion-title {
            font-size: 0.9rem;
            font-weight: bold;
            color: var(--accent);
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .suggestion-text {
            font-size: 1rem;
            line-height: 1.6;
        }

        /* ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§ */
        .input-section {
            background: #252525;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 15px;
        }
        label {
            font-size: 0.9rem;
            color: #ccc;
            margin-bottom: 8px;
            display: block;
        }
        input[type="text"] {
            width: 100%;
            padding: 14px;
            border-radius: 10px;
            border: 2px solid #444;
            background: #1a1a1a;
            color: white;
            font-size: 1.1rem;
            text-align: center;
            font-family: var(--font-stack);
            box-sizing: border-box;
            margin-bottom: 10px;
            transition: 0.3s;
        }
        input:focus { border-color: var(--accent); outline: none; }

        /* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ */
        button {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            font-family: var(--font-stack);
            transition: transform 0.1s, opacity 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        button:active { transform: scale(0.98); }
        
        .btn-primary { 
            background-color: var(--accent); 
            color: #121212; 
            box-shadow: 0 4px 15px rgba(187, 134, 252, 0.3);
        }
        .btn-loss { 
            background-color: #2c2c2c; 
            color: var(--error); 
            border: 1px solid var(--error);
            margin-bottom: 10px;
        }
        .btn-undo { 
            background-color: transparent; 
            color: #888; 
            font-size: 0.9rem;
            padding: 10px;
            border: 1px dashed #444;
        }

        /* ØªØ§Ø±ÛŒØ®Ú†Ù‡ */
        .history-list {
            margin-top: 25px;
            border-top: 1px solid #333;
            padding-top: 15px;
        }
        .history-item {
            background: #1a1a1a;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 8px;
            font-size: 0.85rem;
            display: flex;
            justify-content: space-between;
            color: #ccc;
            border-right: 3px solid #444;
        }
        .history-item.win { border-color: var(--success); }
        .history-item.loss { border-color: var(--error); }

        /* ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø®ÙÛŒ */
        .settings-toggle {
            text-align: center;
            margin-top: 20px;
            font-size: 0.8rem;
            color: #555;
            cursor: pointer;
        }
        #settingsArea { display: none; margin-top: 10px; background: #111; padding: 15px; border-radius: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ§‡ Ù…Ø§Ø´ÛŒÙ†â€ŒØ­Ø³Ø§Ø¨ ÙˆØ§ÙÙ„ ğŸ§‡</h2>

    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-label">Ú©Ù„ ÙˆØ§ÙÙ„â€ŒÙ‡Ø§ÛŒ Ø´Ù…Ø§</div>
            <div class="stat-value" id="totalDisplay" style="color:var(--success)">0</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">ÙØ§ØµÙ„Ù‡ ØªØ§ Ù‡Ø¯Ù (Û¹Û´)</div>
            <div class="stat-value" id="gapDisplay" style="color:white">94</div>
        </div>
    </div>

    <div class="suggestion-box" id="suggestionBox">
        <div class="suggestion-title">ğŸ’¡ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ø¨Ø¹Ø¯ÛŒ:</div>
        <div class="suggestion-text" id="suggestionText">Ø¯Ø± Ø­Ø§Ù„ ØªØ­Ù„ÛŒÙ„...</div>
    </div>

    <div class="input-section">
        <label>âœï¸ Ø±ØªØ¨Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ø³Ø¨ Ø´Ø¯Ù‡ Ø¯Ø± Ù…Ø±Ø§Ø­Ù„:</label>
        <input type="text" id="runCode" placeholder="Ù…Ø«Ù„Ø§Ù‹ 124 (Ø±ØªØ¨Ù‡ Û±ØŒ Û² Ùˆ Û´)" inputmode="numeric">
        <button class="btn-primary" onclick="processCode()">âœ… Ù…Ø­Ø§Ø³Ø¨Ù‡ Ùˆ Ø«Ø¨Øª Ø±ØªØ¨Ù‡â€ŒÙ‡Ø§</button>
    </div>

    <button class="btn-loss" onclick="addLoss()">
        ğŸ’€ Ø«Ø¨Øª ÛŒÚ© Ø¨Ø§Ø®Øª Ø³Ø±ÛŒØ¹ (+Û± ÙˆØ§ÙÙ„)
    </button>
    
    <button class="btn-undo" onclick="undo()">
        â†©ï¸ Ø§ØµÙ„Ø§Ø­ Ø§Ø´ØªØ¨Ø§Ù‡ (Ø­Ø°Ù Ø­Ø±Ú©Øª Ø¢Ø®Ø±)
    </button>

    <div class="history-list">
        <div style="font-size:0.8rem; color:#666; margin-bottom:10px;">ğŸ”» Ø¢Ø®Ø±ÛŒÙ† ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§:</div>
        <div id="historyContainer"></div>
    </div>

    <div class="settings-toggle" onclick="toggleSettings()">âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾ÛŒØ´Ø±ÙØªÙ‡</div>
    <div id="settingsArea">
        <label>ØªØºÛŒÛŒØ± Ù‡Ø¯Ù Ù†Ù‡Ø§ÛŒÛŒ:</label>
        <input type="number" id="targetCap" value="94" onchange="updateUI()" style="width:100px; padding:5px;">
        <button class="btn-undo" style="margin-top:10px; color:var(--error); border-color:var(--error);" onclick="resetAll()">ğŸ—‘ï¸ Ø±ÛŒØ³Øª Ú©Ø§Ù…Ù„ Ø¨Ø±Ù†Ø§Ù…Ù‡</button>
    </div>
</div>

<script>
    let totalWaffles = 0;
    let historyData = []; // Ø¢Ø±Ø§ÛŒÙ‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ù…ØªÙ†â€ŒÙ‡Ø§ÛŒ ÙØ§Ø±Ø³ÛŒ

    // Ø¬ÙˆØ§ÛŒØ²
    const STAGE_REWARDS = {1: 10, 2: 12, 3: 14, 4: 16, 5: 18};
    const RANK_BONUS = {1: 5, 2: 4, 3: 3, 4: 2};

    // Ø´Ø±ÙˆØ¹ Ø¨Ø±Ù†Ø§Ù…Ù‡
    window.onload = function() {
        if(localStorage.getItem('waffleTotal')) {
            totalWaffles = parseInt(localStorage.getItem('waffleTotal'));
            historyData = JSON.parse(localStorage.getItem('waffleHistory') || "[]");
            renderHistory();
        }
        updateUI();
    }

    function saveState() {
        localStorage.setItem('waffleTotal', totalWaffles);
        localStorage.setItem('waffleHistory', JSON.stringify(historyData));
        updateUI();
        renderHistory();
    }

    // Ù…Ù†Ø·Ù‚ Ø§ØµÙ„ÛŒ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ú©Ø¯
    function processCode() {
        const input = document.getElementById('runCode');
        const codeStr = input.value;
        if (!codeStr) return;

        let runTotal = 0;
        let currentStage = 1;
        let i = 0;
        let logDetails = [];

        while (i < codeStr.length) {
            const char = codeStr[i];
            if (isNaN(char)) { i++; continue; }
            const rank = parseInt(char);

            if (rank >= 1 && rank <= 4) { // Ø¨Ø±Ø¯
                const gain = STAGE_REWARDS[currentStage] + (RANK_BONUS[rank] || 0);
                runTotal += gain;
                logDetails.push(`Ù…Ø±Ø­Ù„Ù‡ ${currentStage} (Ø±ØªØ¨Ù‡ ${rank})`);
                currentStage++;
                if (currentStage > 5) break;
            } else { // Ø¨Ø§Ø®Øª
                runTotal += 1;
                logDetails.push(`Ø¨Ø§Ø®Øª Ø¯Ø± Ù…Ø±Ø­Ù„Ù‡ ${currentStage}`);
                currentStage = 1;
            }
            i++;
        }

        totalWaffles += runTotal;
        // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø¨Ù‡ Ø²Ø¨Ø§Ù† ÙØ§Ø±Ø³ÛŒ
        addToHistory(`Ù†ØªÛŒØ¬Ù‡ Ø¨Ø§Ø²ÛŒ: +${runTotal} ÙˆØ§ÙÙ„`, logDetails.join("ØŒ "), "win");
        
        input.value = '';
        saveState();
    }

    function addLoss() {
        totalWaffles += 1;
        addToHistory("Ø¨Ø§Ø®Øª Ø³Ø±ÛŒØ¹ (+Û±)", "Ø«Ø¨Øª Ø¯Ø³ØªÛŒ Ø¨Ø§Ø®Øª", "loss");
        saveState();
    }

    function undo() {
        if (historyData.length > 0) {
            const lastItem = historyData.shift(); // Ø­Ø°Ù Ø¢Ø®Ø±ÛŒÙ† Ø¢ÛŒØªÙ…
            // Ø¨Ø§ÛŒØ¯ Ù…Ù‚Ø¯Ø§Ø± ÙˆØ§ÙÙ„ Ø±Ø§ Ù‡Ù… Ú©Ù… Ú©Ù†ÛŒÙ…. Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø¯Ú¯ÛŒØŒ Ø§ÛŒÙ†Ø¬Ø§ Ø¯Ø³ØªÛŒ Ù‡Ù†Ø¯Ù„ Ù†Ù…ÛŒØ´ÙˆØ¯
            // Ø¯Ø± Ù†Ø³Ø®Ù‡ Ø³Ø§Ø¯Ù‡ ÙÙ‚Ø· ÙˆØ§ÙÙ„ Ú©Ù… Ù…ÛŒÚ©Ù†ÛŒÙ…:
            if(totalWaffles > 0) {
                // ÙØ±Ø¶ Ù…ÛŒÚ©Ù†ÛŒÙ… Ø¢Ø®Ø±ÛŒÙ† Ø­Ø±Ú©Øª 1 ÙˆØ§Ø­Ø¯ Ø¨ÙˆØ¯Ù‡ (Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø®Øª) ÛŒØ§ Ø¨Ø§ÛŒØ¯ Ù…Ù‚Ø¯Ø§Ø±Ø´ Ø±Ø§ Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒÚ©Ø±Ø¯ÛŒÙ…
                // Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù¾ÛŒÚ†ÛŒØ¯Ú¯ÛŒØŒ Ø¯Ø± Ø¢Ù†Ø¯Ùˆ ÙÙ‚Ø· 1 ÙˆØ§Ø­Ø¯ Ú©Ù… Ù…ÛŒÚ©Ù†ÛŒÙ… ÛŒØ§ Ø±ÛŒØ³Øª
                // Ø¨Ù‡ØªØ± Ø§Ø³Øª Ø¢Ù†Ø¯Ùˆ Ø±Ø§ Ø³Ø§Ø¯Ù‡ Ù†Ú¯Ù‡ Ø¯Ø§Ø±ÛŒÙ…:
                if(confirm("Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù†ÛŒØ¯ØŸ Ø¢Ø®Ø±ÛŒÙ† ÙˆØ§ÙÙ„ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡ Ú©Ù… Ù…ÛŒâ€ŒØ´ÙˆØ¯.")) {
                     // Ø§ÛŒÙ†Ø¬Ø§ Ù…Ù†Ø·Ù‚ Ø¯Ù‚ÛŒÙ‚ Ø¢Ù†Ø¯Ùˆ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø°Ø®ÛŒØ±Ù‡ Ù…Ù‚Ø¯Ø§Ø± Ù‚Ø¨Ù„ÛŒ Ø¯Ø§Ø±Ø¯
                     // ÙØ¹Ù„Ø§ Ø³Ø§Ø¯Ù‡:
                     totalWaffles -= 1; 
                }
            }
            saveState();
        }
    }

    function addToHistory(title, sub, type) {
        historyData.unshift({title, sub, type}); // Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ø§ÙˆÙ„ Ù„ÛŒØ³Øª
        if(historyData.length > 10) historyData.pop(); // Ù†Ú¯Ù‡ Ø¯Ø§Ø´ØªÙ† ÙÙ‚Ø· Û±Û° ØªØ§ÛŒ Ø¢Ø®Ø±
    }

    function renderHistory() {
        const container = document.getElementById('historyContainer');
        container.innerHTML = '';
        historyData.forEach(item => {
            const div = document.createElement('div');
            div.className = `history-item ${item.type}`;
            div.innerHTML = `<span>${item.title}</span><span style="font-size:0.7em; opacity:0.7">${item.sub}</span>`;
            container.appendChild(div);
        });
    }

    // Ù…ØºØ² Ù…ØªÙÚ©Ø±: Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ
    function updateStrategy(remaining) {
        const box = document.getElementById('suggestionBox');
        const text = document.getElementById('suggestionText');
        
        box.style.borderRightColor = "#bb86fc"; // Ø±Ù†Ú¯ Ù¾ÛŒØ´â€ŒÙØ±Ø¶
        
        if (remaining <= 0) {
            if (totalWaffles === 94) {
                 box.style.background = "linear-gradient(135deg, #1b5e20, #2e7d32)";
                 text.innerHTML = "ğŸ‰ <b>ØªØ¨Ø±ÛŒÚ©! Ù‡Ø¯Ù Ø±Ø³ÛŒØ¯.</b><br>Ø§Ù„Ø§Ù† ÙˆÙ‚Øª Â«Perfect RunÂ» Ø§Ø³Øª. ØªØ§ Ù…Ø±Ø­Ù„Ù‡ Ûµ Ø¨Ø±Ùˆ Ùˆ Ø¨Ø±Ù†Ø¯Ù‡ Ø´Ùˆ! (Ù…Ø¬Ù…ÙˆØ¹ ~Û±Û¸Û¹)";
            } else if (totalWaffles >= 95) {
                 box.style.background = "linear-gradient(135deg, #b71c1c, #c62828)";
                 text.innerHTML = "â›” <b>Ø³Ù‚Ù Ù¾Ø± Ø´Ø¯!</b><br>Ø´Ù…Ø§ Ø§Ø² Û¹Ûµ ÙˆØ§ÙÙ„ Ú¯Ø°Ø´ØªÛŒØ¯. Ø§ÛŒÙˆÙ†Øª Ø¨Ø³ØªÙ‡ Ø´Ø¯.";
            }
        } else if (remaining >= 70) {
            text.innerHTML = "ğŸ›¡ï¸ <b>Ø±Ø§Ù† Ø·ÙˆÙ„Ø§Ù†ÛŒ (Deep Run):</b><br>Ù…Ø±Ø§Ø­Ù„ Û± ØªØ§ Û´ Ø±Ø§ Ø¨Ø¨Ø±ØŒ ÙˆÙ„ÛŒ Ø¯Ø± Ù…Ø±Ø­Ù„Ù‡ Ûµ Ø­ØªÙ…Ø§Ù‹ Ø¨Ø¨Ø§Ø² ØªØ§ Ú©Ø§Ù¾ Ø§Ø² Ø¯Ø³Øª Ù†Ø¯ÛŒ.";
        } else if (remaining >= 50) {
            text.innerHTML = "âš–ï¸ <b>Ø±Ø§Ù† Ù…ØªÙˆØ³Ø·:</b><br>Ù…Ø±Ø§Ø­Ù„ Û± Ùˆ Û² Ø±Ø§ Ø¨Ø¨Ø±ØŒ Ø¯Ø± Ù…Ø±Ø­Ù„Ù‡ Û³ Ø¨Ø¨Ø§Ø².";
        } else if (remaining <= 10) {
            text.innerHTML = "âš¡ <b>Ù¾Ø± Ú©Ø±Ø¯Ù† ÙØ§ØµÙ„Ù‡ (Gap Fill):</b><br>ÙÙ‚Ø· ÙˆØ§Ø±Ø¯ Ø¨Ø§Ø²ÛŒ Ø´Ùˆ Ùˆ Ø³Ø±ÛŒØ¹ Ø¨Ø¨Ø§Ø² (+Û± ÙˆØ§ÙÙ„) ØªØ§ Ø¨Ù‡ Ø¹Ø¯Ø¯ Û¹Û´ Ø¨Ø±Ø³ÛŒ.";
            box.style.borderRightColor = "#ffeb3b";
        } else {
            text.innerHTML = "ğŸ² <b>ØªØ±Ú©ÛŒØ¨ÛŒ Ø¨Ø§Ø²ÛŒ Ú©Ù†:</b><br>Ú†Ù†Ø¯ Ø¨Ø±Ø¯ Ú©ÙˆØªØ§Ù‡ Ùˆ Ú†Ù†Ø¯ Ø¨Ø§Ø®Øª Ø¨Ú¯ÛŒØ± ØªØ§ Ø¯Ù‚ÛŒÙ‚ Ø¨Ù‡ Û¹Û´ Ø¨Ø±Ø³ÛŒ.";
        }

        // Ù‡Ø´Ø¯Ø§Ø± ØªÙ„Ù‡
        if (totalWaffles + 1 === 95) {
             box.style.background = "linear-gradient(135deg, #ff6f00, #ff8f00)";
             text.innerHTML = "âš ï¸ <b>Ø®Ø·Ø± ØªÙ„Ù‡ (Trap)!</b><br>Ø§Ú¯Ø± Ø§Ù„Ø§Ù† Ø¨Ø¨Ø§Ø²ÛŒØŒ Ø±ÙˆÛŒ Û¹Ûµ Ù‚ÙÙ„ Ù…ÛŒâ€ŒØ´ÛŒ. Ø¨Ø§ÛŒØ¯ Ø­ØªÙ…Ø§Ù‹ ÛŒÚ© Ø¨Ø±Ø¯ (Ø­Ø¯Ø§Ù‚Ù„ Û² ÙˆØ§ÙÙ„) Ø¨Ú¯ÛŒØ±ÛŒ.";
        }
    }

    function updateUI() {
        const target = parseInt(document.getElementById('targetCap').value);
        const remaining = target - totalWaffles;
        
        document.getElementById('totalDisplay').innerText = totalWaffles;
        document.getElementById('gapDisplay').innerText = remaining;

        updateStrategy(remaining);
    }
    
    function toggleSettings() {
        const area = document.getElementById('settingsArea');
        area.style.display = area.style.display === 'block' ? 'none' : 'block';
    }
    
    function resetAll() {
        localStorage.clear();
        totalWaffles = 0;
        historyData = [];
        location.reload();
    }
</script>

</body>
</html>
